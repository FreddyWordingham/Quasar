<textarea id="render-input" class="prism-live language-json fill">
{{ input }}</textarea
>
<hr />
<button id="render-run_button" class="btn btn-primary" onclick="$render.run()">
    Run <i class="bi bi-play-fill"></i>
</button>
<div id="render-progress_bar_continer" class="progress" style="display: none">
    <div
        id="render-progress_bar"
        class="progress-bar progress-bar-striped progress-bar-animated"
        role="progressbar"
        style="width: 0%"
    ></div>
</div>

<script>
    var $render = {
        run: function () {
            $("#render-run_button").hide();
            $("#render-progress_bar_continer").show();

            let config = $("#render-input").val();
            $.ajax({
                url: "/session/id/" + $session_id + "/render",
                type: "post",
                contentType: "application/json",
                data: JSON.stringify({
                    config: config,
                }),
                success: function () {
                    let progress_monitor = setInterval(function () {
                        $.get(
                            "/session/id/" + $session_id + "/render/progress",
                            {},
                            function (response) {
                                console.log(response);
                                if (response == "FINISHED\n") {
                                    clearInterval(progress_monitor);
                                    $("#render-run_button").show();
                                    $("#render-progress_bar_continer").hide();
                                    $("#render-progress_bar")
                                        .css("width", "0%")
                                        .text("");
                                } else {
                                    $("#render-progress_bar")
                                        .css("width", response)
                                        .text(response);
                                }
                            }
                        );

                        let url =
                            "/static/sessions/" +
                            $session_id +
                            "/render.png?" +
                            new Date().getTime();
                        $("#render-result").attr("src", url);
                    }, 1000);
                },
                error: function (response) {
                    alert(response);
                },
            });
        },

        del: function () {
            $("#render-result").remove();
        },
    };

    $(document).ready(function () {
        $("#display_container").append(
            "<img id='render-result' class='display'></img>"
        );

        $plugin.del["render"] = $render.del;
    });
</script>
